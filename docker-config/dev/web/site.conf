real_ip_header X-Forwarded-For;
set_real_ip_from 0.0.0.0/0;

# GZIP COMPRESSION FOR WEB ASSETS
gzip_disable "msie6";
gzip_comp_level 6;
gzip_min_length 1100;
gzip_buffers 16 8k;
gzip_proxied any;
gzip_http_version 1.0;
gzip_types
    text/plain
    text/css
    text/js
    text/xml
    text/javascript
    application/javascript
    application/x-javascript
    application/json
    application/schema+json
    application/vnd.geo+json
    application/xml
    application/rss+xml
    image/svg+xml
    application/x-protobuf pbf;

rewrite_log on;

####################################################################################################
# Provides the mapbox style spec. Doesn't need a SSL as it is only a proxy target.
####################################################################################################
server {
    root /usr/share/nginx/html;

    listen 80;

    location / {
       # Simple requests
       if ($request_method ~* "(GET|POST)") {
         add_header "Access-Control-Allow-Origin"  *;
       }

       # Preflighted requests
       if ($request_method = OPTIONS ) {
         add_header "Access-Control-Allow-Origin"  *;
         add_header "Access-Control-Allow-Methods" "GET, POST, OPTIONS, HEAD";
         add_header "Access-Control-Allow-Headers" "Authorization, Origin, X-Requested-With, Content-Type, Accept";
        }
    }
}
